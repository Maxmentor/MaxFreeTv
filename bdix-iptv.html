<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>maxfreetv</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>

<body class="dark">

<header>
  <h1>BDIX-IPTV</h1>
  <button id="mode">ğŸŒ™ / â˜€ï¸</button>
</header>

<input type="text" id="search" placeholder="Search channel...">

<div id="channels"></div>

<script>
let allChannels = [];
let batchSize = 150;
let currentIndex = 0;

const M3U_URL = "Full-Bdix.m3u"; // Place your m3u file in the same hosting folder
const DEFAULT_LOGO = "tvlogo.png"; // Place a default logo in hosting folder

// Fetch M3U from hosting
fetch(M3U_URL)
  .then(r => r.text())
  .then(text => {
    allChannels = parseM3U(text);
    loadMore();
  });

// Parse M3U
function parseM3U(text){
  const lines = text.split(/\r?\n/);
  const channels = [];
  for(let i=0;i<lines.length;i++){
    if(lines[i].startsWith("#EXTINF")){
      const name = lines[i].split(",").pop().trim();
      const logoMatch = lines[i].match(/tvg-logo="(.*?)"/);
      const logo = logoMatch ? logoMatch[1] : DEFAULT_LOGO;
      const url = lines[i+1]?.trim();
      if(url && url.startsWith("http")){
        channels.push({name,logo,url});
      }
      i++; // Skip next line (URL)
    }
  }
  return channels;
}

// Load in batches
function loadMore(){
  const slice = allChannels.slice(currentIndex, currentIndex+batchSize);
  currentIndex += batchSize;
  render(slice,true);
}

// Render channels
function render(list, append=false){
  const box = document.getElementById("channels");
  if(!append) box.innerHTML="";
  const frag = document.createDocumentFragment();
  list.forEach(ch=>{
    const div = document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <img src="${ch.logo}" onerror="this.src='${DEFAULT_LOGO}'">
      <p>${ch.name}</p>
    `;
    div.onclick = ()=> {
      location.href=`player.html?src=${encodeURIComponent(ch.url)}`;
    };
    frag.appendChild(div);
  });
  box.appendChild(frag);
}

// Infinite scroll
window.addEventListener("scroll", ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 300){
    if(currentIndex < allChannels.length){
      loadMore();
    }
  }
});

// Search
document.getElementById("search").addEventListener("input", e=>{
  const v = e.target.value.toLowerCase();
  if(v===""){
    currentIndex=0;
    document.getElementById("channels").innerHTML="";
    loadMore();
    return;
  }
  const filtered = allChannels.filter(c=>c.name.toLowerCase().includes(v));
  render(filtered.slice(0,500));
});

// Dark/Light toggle
document.getElementById("mode").onclick = ()=>{
  document.body.classList.toggle("light");
};
</script>

</body>
</html>
